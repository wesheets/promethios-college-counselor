{% extends "layout.html" %}

{% block title %}College Counselor - System Insights{% endblock %}

{% block content %}
<div class="system-insights-section">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 class="page-title">System Insights</h1>
        <p class="lead">Behind-the-scenes view of the Promethios Kernel in action.</p>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">Emotional Telemetry</h3>
            <div class="btn-group">
              <button type="button" class="btn btn-sm btn-outline-secondary active" data-time-range="30">30 Days</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-time-range="90">90 Days</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-time-range="180">6 Months</button>
            </div>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <div id="emotion-telemetry-chart" style="height: 300px;"></div>
              </div>
              <div class="col-md-4">
                <div class="telemetry-stats">
                  <h4>Emotional Metrics</h4>
                  <div class="metric-item">
                    <div class="d-flex justify-content-between">
                      <span>Sentiment Average:</span>
                      <span class="metric-value">72.4</span>
                    </div>
                    <div class="progress">
                      <div class="progress-bar bg-success" role="progressbar" style="width: 72.4%" aria-valuenow="72.4" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                  <div class="metric-item">
                    <div class="d-flex justify-content-between">
                      <span>Uncertainty Average:</span>
                      <span class="metric-value">38.7</span>
                    </div>
                    <div class="progress">
                      <div class="progress-bar bg-info" role="progressbar" style="width: 38.7%" aria-valuenow="38.7" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                  <div class="metric-item">
                    <div class="d-flex justify-content-between">
                      <span>Agitation Average:</span>
                      <span class="metric-value">25.3</span>
                    </div>
                    <div class="progress">
                      <div class="progress-bar bg-warning" role="progressbar" style="width: 25.3%" aria-valuenow="25.3" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                  <div class="metric-item">
                    <div class="d-flex justify-content-between">
                      <span>Emotional Volatility:</span>
                      <span class="metric-value">18.9</span>
                    </div>
                    <div class="progress">
                      <div class="progress-bar bg-danger" role="progressbar" style="width: 18.9%" aria-valuenow="18.9" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="telemetry-log mt-4">
              <h4>Recent Emotional Telemetry Logs</h4>
              <div class="log-container">
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-18 09:23:15</div>
                  <div class="log-content">
                    <pre>{"event_type": "emotion_telemetry", "user_id": "u-7842", "sentiment_score": 78, "uncertainty_score": 42, "agitation_score": 23, "journal_id": "j-9273", "timestamp": "2025-05-18T09:23:15.234Z", "emotion_summary": "Positive sentiment with moderate uncertainty about college choices", "confidence": 0.87}</pre>
                  </div>
                </div>
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-17 15:47:32</div>
                  <div class="log-content">
                    <pre>{"event_type": "emotion_telemetry", "user_id": "u-7842", "sentiment_score": 65, "uncertainty_score": 51, "agitation_score": 32, "journal_id": "j-9265", "timestamp": "2025-05-17T15:47:32.781Z", "emotion_summary": "Moderately positive with increasing uncertainty about financial aid", "confidence": 0.92}</pre>
                  </div>
                </div>
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-15 11:12:08</div>
                  <div class="log-content">
                    <pre>{"event_type": "emotion_telemetry", "user_id": "u-7842", "sentiment_score": 82, "uncertainty_score": 28, "agitation_score": 15, "journal_id": "j-9241", "timestamp": "2025-05-15T11:12:08.543Z", "emotion_summary": "High positive sentiment after campus visit, reduced uncertainty", "confidence": 0.94}</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Trust Factor Calculation Logs</h3>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-6">
                <div id="trust-factor-radar" style="height: 300px;"></div>
              </div>
              <div class="col-md-6">
                <div class="trust-factor-breakdown">
                  <h4>Trust Factor Components</h4>
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>Factor</th>
                        <th>Weight</th>
                        <th>Score</th>
                        <th>Contribution</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Academic Alignment</td>
                        <td>0.30</td>
                        <td>85</td>
                        <td>25.5</td>
                      </tr>
                      <tr>
                        <td>Financial Fit</td>
                        <td>0.25</td>
                        <td>72</td>
                        <td>18.0</td>
                      </tr>
                      <tr>
                        <td>Location Match</td>
                        <td>0.15</td>
                        <td>90</td>
                        <td>13.5</td>
                      </tr>
                      <tr>
                        <td>Size Preference</td>
                        <td>0.10</td>
                        <td>65</td>
                        <td>6.5</td>
                      </tr>
                      <tr>
                        <td>Setting Match</td>
                        <td>0.10</td>
                        <td>80</td>
                        <td>8.0</td>
                      </tr>
                      <tr>
                        <td>Emotional Alignment</td>
                        <td>0.10</td>
                        <td>78</td>
                        <td>7.8</td>
                      </tr>
                      <tr class="table-active">
                        <td><strong>Total Trust Score</strong></td>
                        <td>1.00</td>
                        <td>-</td>
                        <td><strong>79.3</strong></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <div class="trust-factor-log">
              <h4>Trust Factor Calculation Logs</h4>
              <div class="log-container">
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-18 10:15:27</div>
                  <div class="log-content">
                    <pre>{"event_type": "trust_factor_calculation", "user_id": "u-7842", "college_id": "c-1234", "timestamp": "2025-05-18T10:15:27.123Z", "factors": {"academic_alignment": {"score": 85, "weight": 0.30, "justification": "GPA of 3.8 is above the college's average of 3.6, SAT score is within the middle 50% range"}, "financial_fit": {"score": 72, "weight": 0.25, "justification": "Net price is 15% below student's specified budget, but limited merit scholarships available"}, "location_match": {"score": 90, "weight": 0.15, "justification": "College is in student's preferred region (West Coast) and within 100 miles of specified location preference"}, "size_preference": {"score": 65, "weight": 0.10, "justification": "College size (15,000) is larger than student's preferred size range (5,000-10,000)"}, "setting_match": {"score": 80, "weight": 0.10, "justification": "Urban setting matches student's preference"}, "emotional_alignment": {"score": 78, "weight": 0.10, "justification": "Journal entries indicate positive sentiment toward similar institutions"}}, "total_score": 79.3, "category": "target", "confidence": 0.89}</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Decision Justification Logs</h3>
          </div>
          <div class="card-body">
            <div class="decision-log">
              <div class="log-container">
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-18 10:16:05</div>
                  <div class="log-content">
                    <pre>{"event_type": "decision_justification", "user_id": "u-7842", "college_id": "c-1234", "timestamp": "2025-05-18T10:16:05.789Z", "decision_type": "recommendation", "justification": "College was recommended as a target school based on trust score of 79.3. Academic profile shows strong alignment with admission requirements. Financial considerations are within budget constraints. Location and setting preferences are well-matched. Student's emotional state indicates positive sentiment toward similar institutions with moderate uncertainty about academic rigor, which this institution addresses through strong support programs.", "factors_considered": ["academic_profile", "financial_constraints", "location_preferences", "emotional_state"], "alternatives_considered": ["c-2345", "c-3456"], "confidence": 0.87, "recommendation_strength": "strong"}</pre>
                  </div>
                </div>
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-17 14:32:18</div>
                  <div class="log-content">
                    <pre>{"event_type": "decision_justification", "user_id": "u-7842", "college_id": "c-2345", "timestamp": "2025-05-17T14:32:18.456Z", "decision_type": "recommendation", "justification": "College was recommended as a safety school based on trust score of 85.7. Academic profile significantly exceeds admission requirements. Financial aid package is generous relative to budget. Location is within preferred region but further from ideal location. Setting matches preferences. Student's emotional state shows low uncertainty about admission chances, making this a confidence-building option in the overall portfolio.", "factors_considered": ["academic_profile", "financial_aid", "location_distance", "emotional_confidence"], "alternatives_considered": ["c-4567", "c-5678"], "confidence": 0.93, "recommendation_strength": "moderate"}</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Governance Core Activity</h3>
          </div>
          <div class="card-body">
            <div class="governance-log">
              <div class="log-container">
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-18 10:17:23</div>
                  <div class="log-content">
                    <pre>{"event_type": "governance_activity", "timestamp": "2025-05-18T10:17:23.567Z", "activity_type": "recommendation_review", "user_id": "u-7842", "description": "Reviewing college recommendations for potential bias in financial fit calculations. Detected slight overemphasis on merit scholarships vs. need-based aid. Applied correction factor of 0.92 to financial fit scores for colleges with high merit focus.", "governance_rule": "financial_equity_rule_3.2", "correction_applied": true, "impact_assessment": "Moderate impact on 3 colleges in recommendation set, changing 1 college from 'target' to 'reach' category.", "confidence": 0.88}</pre>
                  </div>
                </div>
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-17 09:45:12</div>
                  <div class="log-content">
                    <pre>{"event_type": "governance_activity", "timestamp": "2025-05-17T09:45:12.234Z", "activity_type": "emotional_analysis_audit", "user_id": "u-7842", "description": "Auditing emotional analysis of journal entries for consistency and accuracy. Detected potential underestimation of uncertainty in entries mentioning financial concerns. Applied recalibration to uncertainty scores for financial-themed entries.", "governance_rule": "emotional_consistency_rule_2.7", "correction_applied": true, "impact_assessment": "Minor impact on emotional trend analysis, slightly increasing uncertainty trend line.", "confidence": 0.91}</pre>
                  </div>
                </div>
                <div class="log-entry">
                  <div class="log-timestamp">2025-05-16 16:28:37</div>
                  <div class="log-content">
                    <pre>{"event_type": "governance_activity", "timestamp": "2025-05-16T16:28:37.789Z", "activity_type": "explanation_verification", "user_id": "u-7842", "description": "Verifying accuracy of explanations provided for college recommendations. Detected minor inconsistency between trust factor calculation and explanation for location preference. Updated explanation template to more accurately reflect distance calculations.", "governance_rule": "explanation_accuracy_rule_4.1", "correction_applied": true, "impact_assessment": "Minimal impact on user experience, improved explanation accuracy by approximately 7%.", "confidence": 0.95}</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Emotion Telemetry Chart
    const emotionData = {
      dates: ['2025-04-18', '2025-04-25', '2025-05-02', '2025-05-09', '2025-05-16', '2025-05-18'],
      sentiment: [65, 70, 68, 75, 82, 78],
      uncertainty: [55, 48, 42, 35, 28, 42],
      agitation: [40, 35, 30, 25, 15, 23]
    };
    
    const sentimentTrace = {
      x: emotionData.dates,
      y: emotionData.sentiment,
      name: 'Sentiment',
      type: 'scatter',
      mode: 'lines+markers',
      line: {color: '#28a745', width: 3},
      marker: {size: 8}
    };
    
    const uncertaintyTrace = {
      x: emotionData.dates,
      y: emotionData.uncertainty,
      name: 'Uncertainty',
      type: 'scatter',
      mode: 'lines+markers',
      line: {color: '#17a2b8', width: 3},
      marker: {size: 8}
    };
    
    const agitationTrace = {
      x: emotionData.dates,
      y: emotionData.agitation,
      name: 'Agitation',
      type: 'scatter',
      mode: 'lines+markers',
      line: {color: '#ffc107', width: 3},
      marker: {size: 8}
    };
    
    const emotionLayout = {
      title: 'Emotional State Trends',
      xaxis: {title: 'Date'},
      yaxis: {title: 'Score (0-100)', range: [0, 100]},
      margin: {l: 50, r: 50, t: 50, b: 50},
      legend: {orientation: 'h', y: -0.2}
    };
    
    Plotly.newPlot('emotion-telemetry-chart', [sentimentTrace, uncertaintyTrace, agitationTrace], emotionLayout);
    
    // Trust Factor Radar Chart
    const trustFactorData = [{
      type: 'scatterpolar',
      r: [85, 72, 90, 65, 80, 78],
      theta: ['Academic Alignment', 'Financial Fit', 'Location Match', 'Size Preference', 'Setting Match', 'Emotional Alignment'],
      fill: 'toself',
      name: 'Trust Factors',
      line: {color: '#007bff'},
      fillcolor: 'rgba(0, 123, 255, 0.2)'
    }];
    
    const trustFactorLayout = {
      polar: {
        radialaxis: {
          visible: true,
          range: [0, 100]
        }
      },
      showlegend: false,
      margin: {l: 50, r: 50, t: 30, b: 30}
    };
    
    Plotly.newPlot('trust-factor-radar', trustFactorData, trustFactorLayout);
    
    // Time range buttons
    const timeRangeButtons = document.querySelectorAll('[data-time-range]');
    timeRangeButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Remove active class from all buttons
        timeRangeButtons.forEach(btn => btn.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        // In a real implementation, this would fetch data for the selected time range
        // For demo purposes, we'll just show a message
        console.log(`Selected time range: ${this.dataset.timeRange} days`);
      });
    });
  });
</script>

<style>
  .telemetry-stats {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    height: 100%;
  }
  
  .metric-item {
    margin-bottom: 15px;
  }
  
  .metric-value {
    font-weight: bold;
  }
  
  .log-container {
    max-height: 300px;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  }
  
  .log-entry {
    padding: 10px;
    border-bottom: 1px solid #e9ecef;
  }
  
  .log-entry:last-child {
    border-bottom: none;
  }
  
  .log-timestamp {
    font-size: 0.8rem;
    color: #6c757d;
    margin-bottom: 5px;
  }
  
  .log-content {
    font-family: monospace;
    font-size: 0.85rem;
    overflow-x: auto;
  }
  
  .log-content pre {
    margin: 0;
    white-space: pre-wrap;
  }
  
  .trust-factor-breakdown {
    height: 100%;
  }
</style>
{% endblock %}
